# 學習進度追蹤系統設計

## 目標
利用 IndexedDB 幫助學生追蹤單字學習狀況，提供有意義的學習數據和視覺化回饋。支援多用戶使用同一設備，每個用戶有獨立的學習記錄。

## 核心功能

### 0. 多用戶個人檔案系統 ⭐ NEW

**使用情境**: 同一個手機/平板可能有多位學生使用（兄弟姐妹、同班同學等）

#### 功能特色
- **快速切換**: 啟動 APP 時選擇或創建個人檔案
- **獨立資料**: 每個用戶有獨立的學習進度和統計
- **有趣的個人化**: 可愛的頭像、暱稱、個性化主題色

#### 個人檔案選擇畫面設計

**初次進入 APP**:
```
┌─────────────────────────────────────┐
│   🎓 博幼基金會單字學習卡片 🎓      │
├─────────────────────────────────────┤
│                                     │
│      👋 歡迎！你是誰呢？             │
│                                     │
│  ┌────────────────────────────┐    │
│  │   ➕ 創建新的學習檔案        │    │
│  └────────────────────────────┘    │
│                                     │
│       還沒有任何學習檔案喔！         │
│     點擊上方按鈕開始你的學習之旅     │
│                                     │
└─────────────────────────────────────┘
```

**創建個人檔案畫面**:
```
┌─────────────────────────────────────┐
│         建立你的學習檔案 ✨          │
├─────────────────────────────────────┤
│                                     │
│  選擇你的頭像：                      │
│  ┌──┬──┬──┬──┬──┬──┬──┬──┐        │
│  │🦁│🐼│🐨│🐯│🦊│🐸│🐙│🦄│        │
│  └──┴──┴──┴──┴──┴──┴──┴──┘        │
│  ┌──┬──┬──┬──┬──┬──┬──┬──┐        │
│  │🚀│⚽│🎨│📚│🎮│🌈│⭐│🎵│        │
│  └──┴──┴──┴──┴──┴──┴──┴──┘        │
│                                     │
│  你的名字：                          │
│  ┌────────────────────────────┐    │
│  │ 請輸入暱稱...               │    │
│  └────────────────────────────┘    │
│                                     │
│  選擇你喜歡的顏色：                  │
│  ┌──┬──┬──┬──┬──┬──┬──┬──┐        │
│  │🔴│🟠│🟡│🟢│🔵│🟣│🟤│⚫│        │
│  └──┴──┴──┴──┴──┴──┴──┴──┘        │
│                                     │
│  ┌────────────────────────────┐    │
│  │     🎉 開始學習！            │    │
│  └────────────────────────────┘    │
└─────────────────────────────────────┘
```

**選擇現有檔案畫面**:
```
┌─────────────────────────────────────┐
│      選擇你的學習檔案 👋             │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 🦁 小明                      │   │
│  │ 學習中的單字: 45/200         │   │
│  │ 連續學習: 🔥 7 天            │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 🐼 小美                      │   │
│  │ 學習中的單字: 82/200         │   │
│  │ 連續學習: 🔥 3 天            │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 🚀 阿華                      │   │
│  │ 學習中的單字: 120/200        │   │
│  │ 連續學習: 🔥 15 天           │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌────────────────────────────┐    │
│  │   ➕ 新增學習檔案            │    │
│  └────────────────────────────┘    │
│                                     │
│         👤 管理檔案                 │
└─────────────────────────────────────┘
```

**管理檔案畫面**:
- 編輯個人檔案（改名字、頭像、顏色）
- 刪除檔案（需要確認）
- 匯出/匯入學習資料

#### 頭像選項（使用 Emoji）
```typescript
const AVATAR_OPTIONS = [
  // 動物類
  '🦁', '🐼', '🐨', '🐯', '🦊', '🐸', '🐙', '🦄',
  '🐱', '🐶', '🐰', '🐻', '🐷', '🐵', '🐔', '🐧',

  // 物品類
  '🚀', '⚽', '🎨', '📚', '🎮', '🌈', '⭐', '🎵',
  '🎯', '🏆', '💎', '🎪', '🎭', '🎸', '🎬', '🎤',

  // 食物類（可選）
  '🍎', '🍕', '🍦', '🍰', '🍔', '🍪', '🧁', '🍓',
];
```

#### 主題顏色選項
```typescript
const THEME_COLORS = [
  { name: '熱情紅', value: '#EF4444', emoji: '🔴' },
  { name: '活力橙', value: '#F97316', emoji: '🟠' },
  { name: '陽光黃', value: '#EAB308', emoji: '🟡' },
  { name: '清新綠', value: '#22C55E', emoji: '🟢' },
  { name: '天空藍', value: '#3B82F6', emoji: '🔵' },
  { name: '夢幻紫', value: '#A855F7', emoji: '🟣' },
  { name: '沉穩棕', value: '#92400E', emoji: '🟤' },
  { name: '經典黑', value: '#1F2937', emoji: '⚫' },
];
```

#### 動畫效果
- 選擇頭像時有彈跳動畫
- 切換檔案時有滑動過場效果
- 創建新檔案成功時有慶祝動畫（灑花 🎉）



### 1. 學習記錄追蹤
- **答對記錄**: 記錄每次正確回答（語音/鍵盤）
- **答錯記錄**: 記錄錯誤嘗試（僅鍵盤模式）
- **學習時間**: 每個單字的學習時間戳
- **熟練度等級**: 根據答對次數和間隔時間計算

### 2. 熟練度系統（間隔重複學習）
基於 Spaced Repetition 原理：

**等級定義**:
- **New (新)**: 未學習過
- **Learning (學習中)**: 答對 1-2 次
- **Familiar (熟悉)**: 答對 3-4 次
- **Mastered (精通)**: 答對 5+ 次，且最近 7 天內有複習

**複習間隔建議**:
- New → Learning: 立即複習
- Learning → Familiar: 1 天後複習
- Familiar → Mastered: 3 天後複習
- Mastered: 7 天後複習

### 3. 統計數據

**個人統計**:
- 總學習單字數
- 各級別單字數量（New/Learning/Familiar/Mastered）
- 今日學習數量
- 本週學習數量
- 學習連續天數 (Streak)

**級數統計** (每個 Level):
- 總單字數
- 已學習單字數
- 精通單字數
- 平均正確率
- 完成百分比

**單字詳細記錄**:
- 總嘗試次數
- 正確次數
- 錯誤次數
- 正確率
- 最後學習時間
- 下次複習建議時間

### 4. 視覺化呈現

**首頁 (Home)**:
- 學習進度總覽卡片
  - 總學習單字數 / 總單字數
  - 今日學習數
  - 學習連續天數
- 各級數完成度環形圖或進度條
- 需要複習的單字數提醒

**級數選擇頁面**:
- 每個級數顯示完成百分比
- 視覺徽章（未開始/進行中/已完成）
- 需要複習的單字數

**學習頁面 (Learn)**:
- 當前單字的熟練度指示器
- 本次學習進度（X/Y 張卡片）
- 答對/答錯計數器
- 卡片上顯示該單字的學習狀態（星星/徽章）

**統計頁面 (新增)**:
- 學習趨勢圖（每日學習數量）
- 熟練度分布圓餅圖
- 各級數詳細統計
- 最近學習的單字列表
- 需要複習的單字列表

## IndexedDB Schema (支援多用戶)

```typescript
// Database Name: VBCardsLearning
// Version: 2 (新增多用戶支援)

// Store 0: userProfiles (用戶檔案) ⭐ NEW
interface UserProfile {
  userId: string;          // Primary Key: UUID v4
  name: string;            // 用戶暱稱
  avatar: string;          // Emoji 頭像
  themeColor: string;      // 主題顏色 (hex)
  createdAt: Date;         // 建立時間
  lastActiveAt: Date;      // 最後活躍時間

  // 統計快照（用於選擇畫面顯示）
  totalWordsLearned: number;
  currentStreak: number;
  longestStreak: number;
}

// Store 1: wordProgress (單字進度) - 每個用戶獨立
interface WordProgress {
  id: string;              // Primary Key: "userId_level_wordId"
  userId: string;          // ⭐ 關聯用戶 (indexed)
  wordId: string;          // "level_wordId" (e.g., "3_25")
  word: string;            // 英文單字
  level: number;           // 級數
  totalAttempts: number;   // 總嘗試次數
  correctCount: number;    // 正確次數
  incorrectCount: number;  // 錯誤次數
  proficiencyLevel: 'new' | 'learning' | 'familiar' | 'mastered';
  firstLearnedAt: Date;    // 首次學習時間
  lastReviewedAt: Date;    // 最後複習時間
  nextReviewAt: Date;      // 建議下次複習時間
  correctStreak: number;   // 連續答對次數
  inputMethods: {          // 各種輸入方式的統計
    speech: { correct: number; incorrect: number };
    keyboard: { correct: number; incorrect: number };
  };
}

// Store 2: learningHistory (學習歷史) - 每個用戶獨立
interface LearningHistory {
  id: string;              // Primary Key: "userId_timestamp_wordId"
  userId: string;          // ⭐ 關聯用戶 (indexed)
  wordId: string;          // 關聯到 wordProgress
  word: string;
  level: number;
  timestamp: Date;
  isCorrect: boolean;
  inputMethod: 'speech' | 'keyboard';
  responseTime?: number;   // 反應時間（可選）
}

// Store 3: dailyStats (每日統計) - 每個用戶獨立
interface DailyStats {
  id: string;              // Primary Key: "userId_YYYY-MM-DD"
  userId: string;          // ⭐ 關聯用戶 (indexed)
  date: string;            // "YYYY-MM-DD"
  totalWords: number;      // 當日學習單字數
  newWords: number;        // 新學單字數
  reviewWords: number;     // 複習單字數
  correctCount: number;
  incorrectCount: number;
  studyTime: number;       // 學習時長（秒）
  levels: number[];        // 學習了哪些級數
}

// Store 4: userSettings (用戶設置) - 每個用戶獨立
interface UserSettings {
  userId: string;          // Primary Key: userId
  startDate: Date;         // 開始使用日期
  currentStreak: number;   // 當前連續天數
  longestStreak: number;   // 最長連續天數
  totalStudyTime: number;  // 總學習時長
  enableReminders: boolean; // 是否啟用複習提醒
  dailyGoal: number;       // 每日學習目標
}

// Store 5: appSettings (APP 全局設置) ⭐ NEW
interface AppSettings {
  id: 'app';               // Primary Key (single record)
  lastActiveUserId: string | null; // 最後使用的用戶 ID
  showProfileSelector: boolean;    // 啟動時是否顯示選擇畫面
  version: number;         // Schema 版本
}
```

### 索引設計
```typescript
// wordProgress store
- Index: 'userId' (用於查詢特定用戶的所有單字進度)
- Index: 'userId+level' (用於查詢特定用戶的特定級數)

// learningHistory store
- Index: 'userId' (用於查詢特定用戶的學習歷史)
- Index: 'userId+date' (用於查詢特定用戶的每日歷史)

// dailyStats store
- Index: 'userId' (用於查詢特定用戶的統計)
```

## 實作優先級（更新）

### Phase 0: 多用戶系統 ⭐ 優先實作
1. ✅ 設計 IndexedDB schema (支援多用戶)
2. 創建用戶檔案管理系統
   - UserProfile CRUD 操作
   - UUID 生成工具
3. 實作個人檔案選擇畫面
   - 初次進入歡迎畫面
   - 選擇現有檔案畫面
   - 頭像和顏色選擇器
4. 實作個人檔案創建畫面
   - 輸入暱稱
   - 選擇頭像（Emoji 網格）
   - 選擇主題顏色
   - 創建成功動畫
5. 實作檔案管理功能
   - 編輯檔案
   - 刪除檔案（確認對話框）
6. 全局用戶狀態管理
   - React Context 提供當前用戶
   - 用戶切換功能

### Phase 1: 基礎追蹤（MVP）
7. 創建 IndexedDB 工具函數（CRUD）
   - 支援多用戶的查詢和寫入
8. 在 FlashCard 組件整合記錄功能
   - 記錄答對/答錯（關聯到當前用戶）
9. 簡單的統計計算函數
   - 按用戶查詢統計

### Phase 2: 視覺化呈現
10. 首頁添加學習進度卡片（顯示當前用戶數據）
11. 級數選擇頁面顯示完成度
12. 學習頁面顯示單字狀態
13. 個人檔案選擇畫面顯示統計快照

### Phase 3: 進階功能
14. 創建統計頁面（圖表、趨勢）
15. 複習提醒系統
16. 學習連續天數追蹤
17. 匯出/匯入學習數據（按用戶）
18. 用戶數據遷移和備份

## 技術考量

### IndexedDB 工具庫
使用 `idb` 套件（Promised-based IndexedDB wrapper）:
```bash
pnpm add idb
```

### 狀態管理
- 使用 React Context 提供全局學習進度狀態
- Custom hooks 封裝 IndexedDB 操作

### 性能優化
- 批量寫入（減少 IndexedDB 操作次數）
- 使用 IndexedDB 索引加速查詢
- 統計數據本地緩存

### 隱私保護
- 所有數據存儲在本地瀏覽器
- 不上傳到伺服器
- 提供數據清除功能

## UI/UX 改進建議

### 激勵機制
- 學習徽章（連續學習 7/30/100 天）
- 級數完成獎勵動畫
- 每日目標達成慶祝

### 學習路徑
- 智能推薦下一個要學習的級數
- 突出顯示需要複習的單字
- "今日複習"快速入口

### 數據可視化
- 使用簡單的 CSS 圖表（避免大型圖表庫）
- 或使用輕量級庫如 Chart.js

## 多用戶 UI/UX 詳細設計

### 用戶體驗流程

#### 首次使用
```
啟動 APP → 檢查是否有用戶檔案
   ↓ (無)
顯示歡迎畫面 → 點擊「創建新的學習檔案」
   ↓
個人檔案創建畫面 → 選擇頭像、輸入暱稱、選擇顏色
   ↓
創建成功動畫（灑花 🎉） → 進入首頁
```

#### 多用戶使用
```
啟動 APP → 檢查是否有用戶檔案
   ↓ (有)
顯示用戶選擇畫面 → 點擊用戶卡片
   ↓
滑動過場動畫 → 進入首頁（該用戶的數據）
```

#### 切換用戶
```
首頁 → 點擊右上角用戶頭像圖示
   ↓
顯示用戶選擇畫面 → 選擇其他用戶或新增
   ↓
切換成功 → 重新載入該用戶數據
```

### 視覺設計細節

#### 用戶卡片樣式
```css
/* 用戶卡片 */
.user-card {
  - 白色背景，圓角邊框
  - 左側大頭像（Emoji，3-4rem）
  - 右側用戶資訊
  - 底部薄邊條顯示主題顏色
  - 懸停時放大 (scale: 1.02)
  - 點擊時縮小 (scale: 0.98)
  - 陰影效果增強互動感
}
```

#### 頭像選擇器
```css
/* Emoji 網格 */
.avatar-grid {
  - 8x4 網格佈局
  - 每個格子正方形
  - 選中時：放大 + 彈跳動畫 + 外框高亮
  - 未選中時：灰階 + 縮小
  - 點擊時：彈跳動畫
}
```

#### 顏色選擇器
```css
/* 顏色圓點 */
.color-picker {
  - 1x8 橫向排列
  - 圓形色塊
  - 選中時：外圈白色邊框 + 放大
  - 點擊時：脈衝動畫
}
```

#### 動畫效果

**創建成功動畫**:
```javascript
// 步驟 1: 表單淡出
fadeOut(form, 300ms)

// 步驟 2: 顯示慶祝畫面
showCelebration({
  emoji: ['🎉', '🎊', '✨', '🌟'],
  duration: 2000ms,
  message: '歡迎加入，{userName}！'
})

// 步驟 3: 導航到首頁
navigateToHome(500ms delay)
```

**切換用戶動畫**:
```javascript
// 滑動過場
slideOut(currentView, 'left', 200ms)
  .then(() => slideIn(newView, 'right', 200ms))
```

### Header 用戶指示器

在所有頁面的右上角顯示當前用戶：
```
┌─────────────────────────────────────┐
│ 博幼單字卡              🦁 小明  ▼  │
└─────────────────────────────────────┘
```

點擊展開用戶菜單：
```
┌─────────────────────┐
│ 🦁 小明             │ ← 當前用戶（高亮）
│ 學習中: 45 個單字    │
├─────────────────────┤
│ 🔄 切換用戶          │
│ ⚙️ 設定              │
│ 📊 統計              │
└─────────────────────┘
```

### 響應式設計

**手機版** (< 768px):
- 用戶卡片全寬，垂直堆疊
- 頭像網格 4x8（4 列）
- 顏色選擇器垂直排列

**平板/桌面版** (≥ 768px):
- 用戶卡片 2-3 列網格
- 頭像網格 8x4（2 列）
- 顏色選擇器水平排列

### 無障礙設計

- 所有頭像有 alt 文字描述
- 鍵盤導航支援 (Tab, Enter)
- 顏色對比度符合 WCAG AA 標準
- 觸控區域 ≥ 44x44 px

## 問題與決策

1. **是否需要用戶登入/帳號系統？**
   - ✅ 確定：使用本地多用戶檔案系統
   - 所有數據本地存儲，無需伺服器
   - 未來可考慮添加雲端同步（可選功能）

2. **複習演算法複雜度？**
   - 建議：先用簡單的間隔重複
   - 未來可升級為 SM-2 或 FSRS 算法

3. **統計頁面複雜度？**
   - 建議：先做基礎統計（數字、百分比、進度條）
   - 進階圖表可後續添加

4. **用戶檔案數量限制？**
   - 建議：最多 10 個用戶檔案
   - 避免 IndexedDB 過度膨脹
   - 提供刪除功能管理檔案

5. **隱私和安全性？**
   - 無密碼保護（簡化設計，適合家庭使用）
   - 提供檔案刪除確認
   - 數據匯出功能（備份）

## 下一步

### 立即可開始實作
✅ **Phase 0: 多用戶系統** - 已完成設計，可以開始實作：
1. 創建 IndexedDB 工具和 Schema
2. 實作用戶檔案選擇畫面
3. 實作用戶檔案創建流程
4. 整合到現有路由系統

### 需要確認
請確認以下設計決策：
- ✅ 使用 Emoji 作為頭像是否適合？
- ✅ 8 種主題顏色是否足夠？
- ✅ 用戶檔案選擇畫面的 UI 設計是否符合預期？
- ✅ 動畫效果的複雜度是否合適？

如果設計沒問題，我可以立即開始實作 Phase 0 的多用戶系統！
